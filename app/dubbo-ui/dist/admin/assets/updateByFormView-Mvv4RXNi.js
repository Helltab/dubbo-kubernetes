import{u as ne}from"./index-fgUiU05I.js";import{d as se,g as ie,u as ce,n as K,r as de,Q as ue,f as F,c as e,t as a,e as i,o as h,z as _,v as k,h as V,a9 as re,aa as pe,F as _e,y as fe,J as w,B as z,I as P,K as R,G as ye,H as ve,_ as be}from"./index-DjBintlM.js";import{e as he,h as me}from"./traffic-jO2-nS2i.js";import"./js-yaml-lTHa-xT-.js";import"./request-Q-EYbbyM.js";const T=A=>(ye("data-v-67f62203"),A=A(),ve(),A),ke={class:"__container_tagRule_detail"},we={style:{"max-width":"400px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},xe=T(()=>w("br",null,null,-1)),ge=T(()=>w("br",null,null,-1)),Ce=T(()=>w("br",null,null,-1)),$e=T(()=>w("br",null,null,-1)),Ue=T(()=>w("br",null,null,-1)),Ke=T(()=>w("br",null,null,-1)),Oe={class:"bottom-action-footer"},Ne=se({__name:"updateByFormView",setup(A){ie();const E=ce(),O=K(!1),L=K(8);ne().toClipboard;const G=(t,o)=>{var r,x,m,b;let y=`对于服务 ${o||"未指定"}，将满足 `;const v=[];if(((r=t.scope)==null?void 0:r.type)==="labels"&&((x=t.scope.labels)==null?void 0:x.length)>0)t.scope.labels.forEach(n=>{var s,g;let p="";if(n.myKey==="method")p="请求方法";else if((s=n.myKey)!=null&&s.startsWith("args[")){const j=(g=n.myKey.match(/\\[(\\d+)\\]/))==null?void 0:g[1];j!==void 0?p=`第 ${parseInt(j)+1} 个参数`:p=`标签 ${n.myKey||"未指定"}`}else p=`标签 ${n.myKey||"未指定"}`;let d="";const u=n.value||"未指定";switch(n.condition){case"exact":d=`等于 ${u}`;break;case"regex":d=`匹配正则 ${u}`;break;case"prefix":d=`前缀为 ${u}`;break;case"noempty":d="不为空";break;case"empty":d="为空";break;case"wildcard":d=`匹配通配符 ${u}`;break;case"!=":d=`不等于 ${u}`;break;default:d=`${n.condition||"未知关系"} ${u}`}n.condition!=="empty"&&n.condition!=="noempty"&&!n.value?v.push(`${p} 未填写`):v.push(`${p} ${d}`)});else if(((m=t.scope)==null?void 0:m.type)==="addresses"&&((b=t.scope.addresses)!=null&&b.addressesStr)){const n=t.scope.addresses.condition==="="?"等于":"不等于";v.push(`地址 ${n} [${t.scope.addresses.addressesStr}]`)}return v.length===0?y+="任意请求":y+=v.join(" 且 "),y+=` 的请求，导向带有标签 ${t.tagName||"未指定"} 的实例`,y},c=de({ruleGranularity:"application",objectOfAction:"shop-user",enable:!0,faultTolerantProtection:!0,runtime:!0,priority:1,configVersion:""}),H=K([{label:"labels",value:"labels"},{label:"addresses",value:"addresses"}]),J=K([{label:"exact",value:"exact"},{label:"regex",value:"regex"},{label:"prefix",value:"prefix"},{label:"noempty",value:"noempty"},{label:"empty",value:"empty"},{label:"wildcard",value:"wildcard"}]),M=K([{label:"=",value:"="},{label:"!=",value:"!="}]),Q=K([{title:"键",dataIndex:"myKey",key:"myKey"},{title:"关系",dataIndex:"condition",key:"condition"},{title:"值",dataIndex:"value",key:"value"},{title:"操作",dataIndex:"operation",key:"operation"}]),f=K([]),W=(t,o)=>{if(f.value[t].scope.labels.length===1){f.value[t].scope.type="addresses";return}f.value[t].scope.labels.splice(o,1)},X=t=>{f.value[t].scope.labels.push({myKey:"",condition:"exact",value:""})},Y=()=>{f.value.push({tagName:"",scope:{type:"labels",labels:[{myKey:"",condition:"",value:""}],addresses:{condition:"",addressesStr:""}}})},Z=t=>{f.value.splice(t,1)},q=async()=>{var o;const t=await he((o=E.params)==null?void 0:o.ruleName);if(t.code===200){const{configVersion:y,enabled:v,key:r,runtime:x,scope:m,tags:b}=t==null?void 0:t.data;c.configVersion=y,c.enable=v,c.runtime=x,c.ruleGranularity=m,c.objectOfAction=r,f.value=[],b.forEach((n,p)=>{f.value.push({tagName:n.name,scope:{type:"labels",labels:[],addresses:{condition:"=",addressesStr:""}}});const{match:d}=n;let u=[];d.forEach((s,g)=>{u.push({myKey:s.key,condition:Object.keys(s.value)[0],value:s.value[Object.keys(s.value)[0]]})}),f.value[p]&&f.value[p].scope&&(f.value[p].scope.labels=u)})}},I=async()=>{var p;const{ruleGranularity:t,objectOfAction:o,enable:y,faultTolerantProtection:v,runtime:r,priority:x,configVersion:m}=c,b={configVersion:m,scope:t,key:o,enabled:y,runtime:r,tags:[]};f.value.forEach((d,u)=>{const s={name:d.tagName,match:[]};d.scope.labels.forEach((g,j)=>{const S={key:g.myKey,value:{}};S.value[g.condition]=g.value,s.match.push(S)}),b.tags.push(s)}),(await me((p=E.params)==null?void 0:p.ruleName,b)).code===200&&await q()};return ue(()=>{q()}),(t,o)=>{const y=i("a-button"),v=i("a-flex"),r=i("a-form-item"),x=i("a-switch"),m=i("a-col"),b=i("a-input"),n=i("a-input-number"),p=i("a-row"),d=i("a-form"),u=i("a-card"),s=i("a-space"),g=i("a-radio-group"),j=i("a-tag"),S=i("a-select"),ee=i("a-table"),ae=i("a-textarea"),B=i("a-descriptions-item"),te=i("a-descriptions"),le=i("a-affix");return h(),F("div",ke,[e(v,{style:{width:"100%"}},{default:a(()=>[e(m,{span:O.value?24-L.value:24,class:"left"},{default:a(()=>[e(u,null,{default:a(()=>[e(s,{style:{width:"100%"},direction:"vertical",size:"middle"},{default:a(()=>[e(p,null,{default:a(()=>[e(v,{justify:"end",style:{width:"100%"}},{default:a(()=>[e(y,{type:"text",style:{color:"#0a90d5"},onClick:o[0]||(o[0]=l=>O.value=!O.value)},{default:a(()=>[_(" 字段说明 "),O.value?(h(),k(V(pe),{key:1})):(h(),k(V(re),{key:0}))]),_:1})]),_:1}),e(u,{title:"基础信息",style:{width:"100%"},class:"_detail"},{default:a(()=>[e(d,{layout:"horizontal"},{default:a(()=>[e(p,{style:{width:"100%"}},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(r,{label:"规则粒度",required:""},{default:a(()=>[_(" 应用 ")]),_:1}),e(r,{label:"容错保护"},{default:a(()=>[e(x,{checked:c.faultTolerantProtection,"onUpdate:checked":o[1]||(o[1]=l=>c.faultTolerantProtection=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(r,{label:"运行时生效"},{default:a(()=>[e(x,{checked:c.runtime,"onUpdate:checked":o[2]||(o[2]=l=>c.runtime=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})]),_:1}),e(m,{span:12},{default:a(()=>[e(r,{label:"作用对象",required:""},{default:a(()=>[e(b,{disabled:"",value:c.objectOfAction,"onUpdate:value":o[3]||(o[3]=l=>c.objectOfAction=l),style:{width:"200px"}},null,8,["value"])]),_:1}),e(r,{label:"立即启用"},{default:a(()=>[e(x,{checked:c.enable,"onUpdate:checked":o[4]||(o[4]=l=>c.enable=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(r,{label:"优先级"},{default:a(()=>[e(n,{min:"1",value:c.priority,"onUpdate:value":o[5]||(o[5]=l=>c.priority=l)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{title:"标签列表",style:{width:"100%"},class:"_detail"},{default:a(()=>[(h(!0),F(_e,null,fe(f.value,(l,D)=>(h(),k(u,{key:D},{title:a(()=>[e(s,{align:"center"},{default:a(()=>[w("div",null,"路由【"+z(D+1)+"】",1),w("div",we,z(G(l,c.objectOfAction)),1)]),_:2},1024)]),default:a(()=>[e(d,{layout:"horizontal"},{default:a(()=>[e(s,{style:{width:"100%"},direction:"vertical",size:"large"},{default:a(()=>[e(v,{justify:"end"},{default:a(()=>[e(V(P),{onClick:$=>Z(D),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024),e(r,{label:"标签名",required:""},{default:a(()=>[e(b,{placeholder:"隔离环境名",value:l.tagName,"onUpdate:value":$=>l.tagName=$},null,8,["value","onUpdate:value"])]),_:2},1024),e(r,{label:"作用范围",required:""},{default:a(()=>[e(u,null,{default:a(()=>[e(s,{style:{width:"100%"},direction:"vertical"},{default:a(()=>[e(r,{label:"匹配条件类型"},{default:a(()=>[e(g,{value:l.scope.type,"onUpdate:value":$=>l.scope.type=$,options:H.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(s,{align:"start",style:{width:"100%"},direction:"horizontal"},{default:a(()=>{var $;return[e(j,{bordered:!1,color:"processing"},{default:a(()=>[_(z(l.scope.type),1)]),_:2},1024),l.scope.type==="labels"?(h(),k(ee,{key:0,pagination:!1,columns:Q.value,"data-source":($=l.scope)==null?void 0:$.labels},{bodyCell:a(({column:C,record:N,text:Te,index:oe})=>[C.key==="myKey"?(h(),k(b,{key:0,placeholder:"label key",value:N.myKey,"onUpdate:value":U=>N.myKey=U},null,8,["value","onUpdate:value"])):R("",!0),C.key==="condition"?(h(),k(S,{key:1,value:N.condition,"onUpdate:value":U=>N.condition=U,style:{width:"120px"},options:J.value},null,8,["value","onUpdate:value","options"])):R("",!0),C.key==="value"?(h(),k(b,{key:2,placeholder:"label value",value:N.value,"onUpdate:value":U=>N.value=U},null,8,["value","onUpdate:value"])):C.key==="operation"?(h(),k(s,{key:3,align:"center"},{default:a(()=>[e(V(P),{icon:"tdesign:remove",class:"action-icon",onClick:U=>W(D,oe)},null,8,["onClick"]),e(V(P),{class:"action-icon",icon:"tdesign:add",onClick:U=>X(D)},null,8,["onClick"])]),_:2},1024)):R("",!0)]),_:2},1032,["columns","data-source"])):(h(),k(s,{key:1,align:"start"},{default:a(()=>[e(S,{style:{width:"120px"},value:l.scope.addresses.condition,"onUpdate:value":C=>l.scope.addresses.condition=C,options:M.value},null,8,["value","onUpdate:value","options"]),e(ae,{style:{width:"500px"},value:l.scope.addresses.addressesStr,"onUpdate:value":C=>l.scope.addresses.addressesStr=C,placeholder:'地址列表，如有多个用"，"隔开'},null,8,["value","onUpdate:value"])]),_:2},1024))]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(y,{onClick:Y,type:"primary"},{default:a(()=>[_(" 增加标签")]),_:1})]),_:1})]),_:1})]),_:1},8,["span"]),e(m,{span:O.value?L.value:0,class:"right"},{default:a(()=>[O.value?(h(),k(u,{key:0,class:"sliderBox"},{default:a(()=>[w("div",null,[e(te,{title:"字段说明",column:1},{default:a(()=>[e(B,{label:"key"},{default:a(()=>[_(" 作用对象"),xe,_(" 可能的值：Dubbo应用名或者服务名 ")]),_:1}),e(B,{label:"scope"},{default:a(()=>[_(" 规则粒度"),ge,_(" 可能的值：application, service ")]),_:1}),e(B,{label:"force"},{default:a(()=>[_(" 容错保护"),Ce,_(" 可能的值：true, false"),$e,_(" 描述：如果为true，则路由筛选后若没有可用的地址则会直接报异常；如果为false，则会从可用地址中选择完成RPC调用 ")]),_:1}),e(B,{label:"runtime"},{default:a(()=>[_(" 运行时生效"),Ue,_(" 可能的值：true, false"),Ke,_(" 描述：如果为true，则该rule下的所有路由将会实时生效；若为false，则只有在启动时才会生效 ")]),_:1})]),_:1})])]),_:1})):R("",!0)]),_:1},8,["span"])]),_:1}),e(le,{"offset-bottom":10},{default:a(()=>[w("div",Oe,[e(s,{align:"center",size:"large"},{default:a(()=>[e(y,{type:"primary",onClick:I},{default:a(()=>[_(" 确认")]),_:1}),e(y,null,{default:a(()=>[_(" 取消")]),_:1})]),_:1})])]),_:1})])}}}),Be=be(Ne,[["__scopeId","data-v-67f62203"]]);export{Be as default};

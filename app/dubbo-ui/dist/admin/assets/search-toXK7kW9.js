import{d as A,k as P,b as x,u as D,n as E,r as Q,w as $,f as p,c as S,t as v,h as k,P as B,M as L,e as G,o as i,F as b,z as _,B as m,J as I,I as M,v as q,y as O,K as F,m as Y,_ as J}from"./index-k-mndfGE.js";import{s as K}from"./service-BHs9EO9P.js";import{S as z,a as H}from"./SearchUtil-XKGy71Cs.js";import{p as X,q as h}from"./PromQueryUtil-_SJOcmqa.js";import"./request-J76qzA4C.js";const j={class:"__container_services_index"},U=["onClick"],W=A({__name:"search",setup(Z){P(a=>({"3ac44584":k(B)}));const w=x(),y=D();let C=y.query.query;const N=[{title:"service",key:"service",dataIndex:"serviceName",sorter:!0,width:"30%",ellipsis:!0},{title:"versionGroup",key:"versionGroup",dataIndex:"versionGroupSelect",width:"25%"},{title:"avgQPS",key:"avgQPS",dataIndex:"avgQPS",sorter:!0,width:"15%"},{title:"avgRT",key:"avgRT",dataIndex:"avgRT",sorter:!0,width:"15%"},{title:"requestTotal",key:"requestTotal",dataIndex:"requestTotal",sorter:!0,width:"15%"}],t=E([]),f=a=>a.map(e=>(e.versionGroupSelect={},e.versionGroupSelect.versionGroupArr=e.versionGroups.map(r=>r.versionGroup=(r.version?"version: "+r.version+", ":"")+(r.group?"group: "+r.group:"")||"无"),e.versionGroupSelect.versionGroupValue=e.versionGroupSelect.versionGroupArr[0],e));function T(a,e){return K(a).then(async r=>{var u;return t.value=(u=r.data)==null?void 0:u.list,t.value.forEach(o=>{o.selectedIndex=-1}),console.log(t.value),X(r,["avgQPS","avgRT","requestTotal"],async o=>{o.avgQPS=await h(`sum (dubbo_provider_qps_total{interface='${o.serviceName}'}) by (interface)`),o.avgRT=await h(`avg(dubbo_consumer_rt_avg_milliseconds_aggregate{interface="${o.serviceName}",method=~"$method"}>0)`),o.requestTotal=await h(`sum (increase(dubbo_provider_requests_total{interface="${o.serviceName}"}[1m]))`)})})}const n=Q(new z([{label:"serviceName",param:"keywords",placeholder:"typeAppName",defaultValue:C,style:{width:"200px"}}],T,N,void 0,void 0,f));n.onSearch(f),n.tableStyle={scrollX:"100",scrollY:"367px"};const V=(a,e,r)=>{r==="无"?t.value[a].selectedIndex=-1:t.value[a].selectedIndex=e},R=(a,e)=>{var l,s,c;const r=(l=t.value[e])==null?void 0:l.selectedIndex,u=((s=t.value[e].versionGroups[r])==null?void 0:s.group)||"",o=((c=t.value[e].versionGroups[r])==null?void 0:c.version)||"";w.push({name:"distribution",params:{pathId:a,group:u,version:o}})};return L(Y.SEARCH_DOMAIN,n),$(y,(a,e)=>{n.queryForm.keywords=a.query.query,n.onSearch(),console.log(a)}),(a,e)=>{const r=G("a-select-option"),u=G("a-select");return i(),p("div",j,[S(H,{"search-domain":n},{bodyCell:v(({column:o,record:l,text:s,index:c})=>[o.dataIndex==="serviceName"?(i(),p(b,{key:0},[_(m(l.versionGroup)+" ",1),I("span",{class:"service-link",onClick:d=>R(s,c)},[I("b",null,[S(k(M),{style:{"margin-bottom":"-2px"},icon:"material-symbols:attach-file-rounded"}),_(" "+m(s),1)])],8,U)],64)):o.dataIndex==="versionGroupSelect"?(i(),q(u,{key:1,value:s==null?void 0:s.versionGroupValue,bordered:!1,style:{width:"80%"}},{default:v(()=>[(i(!0),p(b,null,O(s==null?void 0:s.versionGroupArr,(d,g)=>(i(),q(r,{value:d,onClick:ee=>V(c,g,d),key:g},{default:v(()=>[_(m(d),1)]),_:2},1032,["value","onClick"]))),128))]),_:2},1032,["value"])):F("",!0)]),_:1},8,["search-domain"])])}}}),ne=J(W,[["__scopeId","data-v-77fd4b55"]]);export{ne as default};

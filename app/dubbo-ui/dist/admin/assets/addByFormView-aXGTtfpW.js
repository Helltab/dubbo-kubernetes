import{u as oe}from"./index-fgUiU05I.js";import{d as ne,g as se,u as ie,n as K,b as ce,r as de,f as q,c as e,t,e as s,o as _,z as i,v as m,h as D,a9 as ue,aa as re,F as pe,y as _e,J as k,B as A,I as P,K as z,G as fe,H as ye,_ as ve}from"./index-DjBintlM.js";import{f as be}from"./traffic-jO2-nS2i.js";import"./request-Q-EYbbyM.js";const S=R=>(fe("data-v-66e6f7f9"),R=R(),ye(),R),he={class:"__container_tagRule_detail"},me={style:{"max-width":"400px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},ke=S(()=>k("br",null,null,-1)),xe=S(()=>k("br",null,null,-1)),we=S(()=>k("br",null,null,-1)),ge=S(()=>k("br",null,null,-1)),$e=S(()=>k("br",null,null,-1)),Ce=S(()=>k("br",null,null,-1)),Ue={class:"bottom-action-footer"},Ke=ne({__name:"addByFormView",setup(R){se(),ie();const O=K(!1),L=K(8);oe().toClipboard;const E=ce(),F=(l,o)=>{var d,$,v,b;let f=`对于服务 ${o||"未指定"}，将满足 `;const y=[];if(((d=l.scope)==null?void 0:d.type)==="labels"&&(($=l.scope.labels)==null?void 0:$.length)>0)l.scope.labels.forEach(n=>{var r,w;let h="";if(n.myKey==="method")h="请求方法";else if((r=n.myKey)!=null&&r.startsWith("args[")){const T=(w=n.myKey.match(/\\[(\\d+)\\]/))==null?void 0:w[1];T!==void 0?h=`第 ${parseInt(T)+1} 个参数`:h=`标签 ${n.myKey||"未指定"}`}else h=`标签 ${n.myKey||"未指定"}`;let c="";const u=n.value||"未指定";switch(n.condition){case"exact":c=`等于 ${u}`;break;case"regex":c=`匹配正则 ${u}`;break;case"prefix":c=`前缀为 ${u}`;break;case"noempty":c="不为空";break;case"empty":c="为空";break;case"wildcard":c=`匹配通配符 ${u}`;break;case"!=":c=`不等于 ${u}`;break;default:c=`${n.condition||"未知关系"} ${u}`}n.condition!=="empty"&&n.condition!=="noempty"&&!n.value?y.push(`${h} 未填写`):y.push(`${h} ${c}`)});else if(((v=l.scope)==null?void 0:v.type)==="addresses"&&((b=l.scope.addresses)!=null&&b.addressesStr)){const n=l.scope.addresses.condition==="="?"等于":"不等于";y.push(`地址 ${n} [${l.scope.addresses.addressesStr}]`)}return y.length===0?f+="任意请求":f+=y.join(" 且 "),f+=` 的请求，导向带有标签 ${l.tagName||"未指定"} 的实例`,f},p=de({ruleGranularity:"application",objectOfAction:"",enable:!0,faultTolerantProtection:!0,runtime:!0,priority:1,configVersion:"v3.0"}),G=K([{label:"labels",value:"labels"},{label:"addresses",value:"addresses"}]),H=K([{label:"exact",value:"exact"},{label:"regex",value:"regex"},{label:"prefix",value:"prefix"},{label:"noempty",value:"noempty"},{label:"empty",value:"empty"},{label:"wildcard",value:"wildcard"}]),J=K([{label:"=",value:"="},{label:"!=",value:"!="}]),W=K([{title:"键",dataIndex:"myKey",key:"myKey"},{title:"关系",dataIndex:"condition",key:"condition"},{title:"值",dataIndex:"value",key:"value"},{title:"操作",dataIndex:"operation",key:"operation"}]),x=K([]),M=(l,o)=>{if(x.value[l].scope.labels.length===1){x.value[l].scope.type="addresses";return}x.value[l].scope.labels.splice(o,1)},Q=l=>{x.value[l].scope.labels.push({myKey:"",condition:"exact",value:""})},X=()=>{x.value.push({tagName:"",scope:{type:"labels",labels:[{myKey:"",condition:"",value:""}],addresses:{condition:"",addressesStr:""}}})},Y=l=>{x.value.splice(l,1)},Z=async()=>{const{ruleGranularity:l,objectOfAction:o,enable:f,faultTolerantProtection:y,runtime:d,priority:$,configVersion:v}=p,b={configVersion:v,scope:l,key:o,enabled:f,runtime:d,tags:[]};x.value.forEach((c,u)=>{const r={name:c.tagName,match:[]};c.scope.labels.forEach((w,T)=>{const j={key:w.myKey,value:{}};j.value[w.condition]=w.value,r.match.push(j)}),b.tags.push(r)});let n="";l=="application"?n=`${o}.tag-router`:n=`${o}:${v}.tag-router`,(await be(n,b)).code===200&&E.push("/traffic/tagRule")};return(l,o)=>{const f=s("a-button"),y=s("a-flex"),d=s("a-form-item"),$=s("a-switch"),v=s("a-col"),b=s("a-input"),n=s("a-input-number"),h=s("a-row"),c=s("a-form"),u=s("a-card"),r=s("a-space"),w=s("a-radio-group"),T=s("a-tag"),j=s("a-select"),I=s("a-table"),ee=s("a-textarea"),V=s("a-descriptions-item"),te=s("a-descriptions"),ae=s("a-affix");return _(),q("div",he,[e(y,{style:{width:"100%"}},{default:t(()=>[e(v,{span:O.value?24-L.value:24,class:"left"},{default:t(()=>[e(u,null,{default:t(()=>[e(r,{style:{width:"100%"},direction:"vertical",size:"middle"},{default:t(()=>[e(h,null,{default:t(()=>[e(y,{justify:"end",style:{width:"100%"}},{default:t(()=>[e(f,{type:"text",style:{color:"#0a90d5"},onClick:o[0]||(o[0]=a=>O.value=!O.value)},{default:t(()=>[i(" 字段说明 "),O.value?(_(),m(D(re),{key:1})):(_(),m(D(ue),{key:0}))]),_:1})]),_:1}),e(u,{title:"基础信息",style:{width:"100%"},class:"_detail"},{default:t(()=>[e(c,{layout:"horizontal"},{default:t(()=>[e(h,{style:{width:"100%"}},{default:t(()=>[e(v,{span:12},{default:t(()=>[e(d,{label:"规则粒度",required:""},{default:t(()=>[i(" 应用 ")]),_:1}),e(d,{label:"容错保护"},{default:t(()=>[e($,{checked:p.faultTolerantProtection,"onUpdate:checked":o[1]||(o[1]=a=>p.faultTolerantProtection=a),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(d,{label:"运行时生效"},{default:t(()=>[e($,{checked:p.runtime,"onUpdate:checked":o[2]||(o[2]=a=>p.runtime=a),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})]),_:1}),e(v,{span:12},{default:t(()=>[e(d,{label:"作用对象",required:""},{default:t(()=>[e(b,{value:p.objectOfAction,"onUpdate:value":o[3]||(o[3]=a=>p.objectOfAction=a),style:{width:"200px"}},null,8,["value"])]),_:1}),e(d,{label:"立即启用"},{default:t(()=>[e($,{checked:p.enable,"onUpdate:checked":o[4]||(o[4]=a=>p.enable=a),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(d,{label:"优先级"},{default:t(()=>[e(n,{min:"1",value:p.priority,"onUpdate:value":o[5]||(o[5]=a=>p.priority=a)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{title:"标签列表",style:{width:"100%"},class:"_detail"},{default:t(()=>[(_(!0),q(pe,null,_e(x.value,(a,B)=>(_(),m(u,{key:B},{title:t(()=>[e(r,{align:"center"},{default:t(()=>[k("div",null,"路由【"+A(B+1)+"】",1),k("div",me,A(F(a,p.objectOfAction)),1)]),_:2},1024)]),default:t(()=>[e(c,{layout:"horizontal"},{default:t(()=>[e(r,{style:{width:"100%"},direction:"vertical",size:"large"},{default:t(()=>[e(y,{justify:"end"},{default:t(()=>[e(D(P),{onClick:C=>Y(B),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024),e(d,{label:"标签名",required:""},{default:t(()=>[e(b,{placeholder:"隔离环境名",value:a.tagName,"onUpdate:value":C=>a.tagName=C},null,8,["value","onUpdate:value"])]),_:2},1024),e(d,{label:"作用范围",required:""},{default:t(()=>[e(u,null,{default:t(()=>[e(r,{style:{width:"100%"},direction:"vertical"},{default:t(()=>[e(d,{label:"匹配条件类型"},{default:t(()=>[e(w,{value:a.scope.type,"onUpdate:value":C=>a.scope.type=C,options:G.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(r,{align:"start",style:{width:"100%"},direction:"horizontal"},{default:t(()=>{var C;return[e(T,{bordered:!1,color:"processing"},{default:t(()=>[i(A(a.scope.type),1)]),_:2},1024),a.scope.type==="labels"?(_(),m(I,{key:0,pagination:!1,columns:W.value,"data-source":(C=a.scope)==null?void 0:C.labels},{bodyCell:t(({column:g,record:N,text:Oe,index:le})=>[g.key==="myKey"?(_(),m(b,{key:0,placeholder:"label key",value:N.myKey,"onUpdate:value":U=>N.myKey=U},null,8,["value","onUpdate:value"])):z("",!0),g.key==="condition"?(_(),m(j,{key:1,value:N.condition,"onUpdate:value":U=>N.condition=U,style:{width:"120px"},options:H.value},null,8,["value","onUpdate:value","options"])):z("",!0),g.key==="value"?(_(),m(b,{key:2,placeholder:"label value",value:N.value,"onUpdate:value":U=>N.value=U},null,8,["value","onUpdate:value"])):g.key==="operation"?(_(),m(r,{key:3,align:"center"},{default:t(()=>[e(D(P),{icon:"tdesign:remove",class:"action-icon",onClick:U=>M(B,le)},null,8,["onClick"]),e(D(P),{class:"action-icon",icon:"tdesign:add",onClick:U=>Q(B)},null,8,["onClick"])]),_:2},1024)):z("",!0)]),_:2},1032,["columns","data-source"])):(_(),m(r,{key:1,align:"start"},{default:t(()=>[e(j,{style:{width:"120px"},value:a.scope.addresses.condition,"onUpdate:value":g=>a.scope.addresses.condition=g,options:J.value},null,8,["value","onUpdate:value","options"]),e(ee,{style:{width:"500px"},value:a.scope.addresses.addressesStr,"onUpdate:value":g=>a.scope.addresses.addressesStr=g,placeholder:'地址列表，如有多个用"，"隔开'},null,8,["value","onUpdate:value"])]),_:2},1024))]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(f,{onClick:X,type:"primary"},{default:t(()=>[i(" 增加标签")]),_:1})]),_:1})]),_:1})]),_:1},8,["span"]),e(v,{span:O.value?L.value:0,class:"right"},{default:t(()=>[O.value?(_(),m(u,{key:0,class:"sliderBox"},{default:t(()=>[k("div",null,[e(te,{title:"字段说明",column:1},{default:t(()=>[e(V,{label:"key"},{default:t(()=>[i(" 作用对象"),ke,i(" 可能的值：Dubbo应用名或者服务名 ")]),_:1}),e(V,{label:"scope"},{default:t(()=>[i(" 规则粒度"),xe,i(" 可能的值：application, service ")]),_:1}),e(V,{label:"force"},{default:t(()=>[i(" 容错保护"),we,i(" 可能的值：true, false"),ge,i(" 描述：如果为true，则路由筛选后若没有可用的地址则会直接报异常；如果为false，则会从可用地址中选择完成RPC调用 ")]),_:1}),e(V,{label:"runtime"},{default:t(()=>[i(" 运行时生效"),$e,i(" 可能的值：true, false"),Ce,i(" 描述：如果为true，则该rule下的所有路由将会实时生效；若为false，则只有在启动时才会生效 ")]),_:1})]),_:1})])]),_:1})):z("",!0)]),_:1},8,["span"])]),_:1}),e(ae,{"offset-bottom":10},{default:t(()=>[k("div",Ue,[e(r,{align:"center",size:"large"},{default:t(()=>[e(f,{type:"primary",onClick:Z},{default:t(()=>[i(" 确认")]),_:1}),e(f,null,{default:t(()=>[i(" 取消")]),_:1})]),_:1})])]),_:1})])}}}),Be=ve(Ke,[["__scopeId","data-v-66e6f7f9"]]);export{Be as default};

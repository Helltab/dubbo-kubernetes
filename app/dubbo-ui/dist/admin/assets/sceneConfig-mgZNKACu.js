import{c as n,A as ee,d as W,n as V,e as m,o as u,f as D,t,J as X,B as $,v as _,h as N,a4 as ae,a5 as te,a6 as ne,a7 as oe,F as z,y as J,z as R,K as w,a3 as Q,_ as Y,u as se,r as ie,Q as re}from"./index-uR6obgcO.js";import{C as le}from"./ConfigPage-xLaejlpn.js";import{c as ue,u as de,d as ce,e as me,f as ve,h as pe,i as fe,j as _e}from"./service-rEDN1g22.js";import"./request-QeNrWFvM.js";var ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"};const ye=ge;function q(b){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},f=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(o).filter(function(I){return Object.getOwnPropertyDescriptor(o,I).enumerable}))),f.forEach(function(I){he(b,I,o[I])})}return b}function he(b,r,o){return r in b?Object.defineProperty(b,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):b[r]=o,b}var H=function(r,o){var f=q({},r,o.attrs);return n(ee,q({},f,{icon:ye}),null)};H.displayName="MinusOutlined";H.inheritAttrs=!1;const G=H,be={class:"__container_services_tabs_param_route"},Pe=W({__name:"paramRoute",props:{paramRouteForm:{type:Object,default:()=>{}},index:{type:Number}},emits:["deleteParamRoute","update"],setup(b,{emit:r}){const o=V(!1),f=()=>{o.value=!0},I=r,k=b,s=V({method:{value:void 0,selectArr:[{label:"getUserInfo",value:"getUserInfo"},{label:"register",value:"register"},{label:"login",value:"login"}]},functionParams:[],destination:[]}),j=()=>{o.value=!1;let a=JSON.parse(JSON.stringify(k.paramRouteForm));s.value={method:{value:a.method,selectArr:[{label:"getUserInfo",value:"getUserInfo"},{label:"register",value:"register"},{label:"login",value:"login"}]},functionParams:a.conditions,destination:a.destinations}};j();const A=()=>{o.value=!1,I("update",k.index,s.value)},U=[{title:"参数索引",key:"index",dataIndex:"index",width:"30%"},{title:"关系",key:"relation",dataIndex:"relation",width:"30%"},{title:"值",key:"value",dataIndex:"value",width:"30%"},{title:"操作",key:"handle",dataIndex:"handle",width:"10%"}],E=[{title:"标签",key:"tag",dataIndex:"tag",width:"25%"},{title:"关系",key:"relation",dataIndex:"relation",width:"25%"},{title:"值",key:"value",dataIndex:"value",width:"25%"},{title:"操作",key:"handle",dataIndex:"handle",width:"10%"}],O=()=>{s.value.functionParams.push({index:"",relation:"",value:""})},M=a=>{s.value.functionParams.splice(a,1)},F=()=>{s.value.destination.push({conditions:[{tag:"",relation:"",value:""}],weight:0})},B=a=>{s.value.destination[a].conditions.push({tag:"",relation:"",value:""})},e=a=>{s.value.destination.splice(a,1)};return(a,i)=>{const l=m("a-flex"),d=m("a-select-option"),c=m("a-select"),P=m("a-form-item"),v=m("a-button"),p=m("a-input"),S=m("a-table"),T=m("a-space"),L=m("a-card"),Z=m("a-form");return u(),D("div",be,[n(L,{bordered:!1,style:{width:"1000px"}},{title:t(()=>[n(l,{justify:"space-between"},{default:t(()=>[X("span",null,"路由"+$((k==null?void 0:k.index)+1),1),o.value?(u(),_(l,{key:1,class:"handle-form"},{default:t(()=>[n(N(ne),{onClick:A,class:"edit-icon"}),n(N(oe),{onClick:j,class:"edit-icon"})]),_:1})):(u(),_(l,{key:0,class:"handle-form"},{default:t(()=>[n(N(ae),{onClick:f,class:"edit-icon"}),n(N(te),{onClick:i[0]||(i[0]=g=>I("deleteParamRoute",k.index)),class:"edit-icon"})]),_:1}))]),_:1})]),default:t(()=>[n(Z,{labelCol:{span:3},disabled:!o.value},{default:t(()=>[n(P,{label:"选择方法"},{default:t(()=>[n(c,{value:s.value.method.value,"onUpdate:value":i[1]||(i[1]=g=>s.value.method.value=g),style:{width:"200px"}},{default:t(()=>[(u(!0),D(z,null,J(s.value.method.selectArr,(g,y)=>(u(),_(d,{value:g.value,key:y},{default:t(()=>[R($(g.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(P,{label:"指定方法参数"},{default:t(()=>[n(T,{direction:"vertical"},{default:t(()=>[n(v,{type:"primary",onClick:O,disabled:!o.value},{default:t(()=>[R(" 添加参数 ")]),_:1},8,["disabled"]),n(S,{columns:U,"data-source":s.value.functionParams,pagination:!1},{bodyCell:t(({column:g,index:y})=>[g.dataIndex==="index"?(u(),_(p,{key:0,value:s.value.functionParams[y].index,"onUpdate:value":h=>s.value.functionParams[y].index=h},null,8,["value","onUpdate:value"])):w("",!0),g.dataIndex==="relation"?(u(),_(p,{key:1,value:s.value.functionParams[y].relation,"onUpdate:value":h=>s.value.functionParams[y].relation=h},null,8,["value","onUpdate:value"])):w("",!0),g.dataIndex==="value"?(u(),_(p,{key:2,value:s.value.functionParams[y].value,"onUpdate:value":h=>s.value.functionParams[y].value=h},null,8,["value","onUpdate:value"])):w("",!0),g.dataIndex==="handle"?(u(),_(l,{key:3,justify:"space-between"},{default:t(()=>[n(N(G),{class:Q(["edit-icon",{"disabled-icon":!o.value||s.value.functionParams.length===1}]),onClick:h=>o.value&&s.value.functionParams.length!==1&&M(k.index,y)},null,8,["class","onClick"])]),_:2},1024)):w("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1}),n(P,{label:"路由目的地"},{default:t(()=>[n(T,{direction:"vertical"},{default:t(()=>[n(v,{type:"primary",onClick:F},{default:t(()=>[R(" 添加目的地 ")]),_:1}),(u(!0),D(z,null,J(s.value.destination,(g,y)=>(u(),_(L,{bordered:!1},{title:t(()=>[n(T,null,{default:t(()=>[R(" 目的地"+$(y+1)+" ",1),n(v,{type:"primary",onClick:h=>B(y)},{default:t(()=>[R(" 添加条件 ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[n(S,{columns:E,"data-source":g.conditions,pagination:!1},{bodyCell:t(({column:h,index:K,record:x})=>[h.dataIndex==="tag"?(u(),_(p,{key:0,value:x.tag,"onUpdate:value":C=>x.tag=C},null,8,["value","onUpdate:value"])):w("",!0),h.dataIndex==="relation"?(u(),_(p,{key:1,value:x.relation,"onUpdate:value":C=>x.relation=C},null,8,["value","onUpdate:value"])):w("",!0),h.dataIndex==="value"?(u(),_(p,{key:2,value:x.value,"onUpdate:value":C=>x.value=C},null,8,["value","onUpdate:value"])):w("",!0),h.dataIndex==="handle"?(u(),_(l,{key:3,justify:"space-between"},{default:t(()=>[n(N(G),{class:Q(["edit-icon",{"disabled-icon":!o.value||s.value.functionParams.length===1}]),onClick:C=>o.value&&s.value.functionParams.length!==1&&e(K)},null,8,["class","onClick"])]),_:2},1024)):w("",!0)]),_:2},1032,["data-source"])]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1})])}}}),Ie=Y(Pe,[["__scopeId","data-v-aeae6d4f"]]),ke={class:"__container_services_tabs_scene_config"},we={class:"param-route"},Re=W({__name:"sceneConfig",setup(b){const r=se(),o=ie({list:[{title:"serviceDomain.timeout",key:"timeout",form:{timeout:1e3},submit:e=>new Promise(a=>{a(E(e==null?void 0:e.timeout))}),async reset(e){await U()}},{title:"serviceDomain.retryNum",key:"retryNum",form:{retryNum:0},submit:e=>new Promise(a=>{a(M(e==null?void 0:e.retryNum))}),async reset(e){await O()}},{title:"serviceDomain.sameAreaFirst",key:"sameAreaFirst",form:{sameAreaFirst:!1},submit:e=>new Promise(a=>{a(B(e==null?void 0:e.sameAreaFirst))}),async reset(e){await F()}},{title:"serviceDomain.paramRoute",key:"paramRoute",form:{paramRoute:[]}}],current:[0]}),f=V([{method:"string",conditions:[{index:"string",relation:"string",value:"string"}],destinations:[{conditions:[{tag:"string",relation:"string",value:"string"}],weight:0}]}]),I=()=>{f.value.push({method:"string",conditions:[{index:"string",relation:"string",value:"string"}],destinations:[{conditions:[{tag:"string",relation:"string",value:"string"}],weight:0}]}),s(),A()},k=(e,a)=>{const i={conditions:a.functionParams,destinations:a.destination,method:a.method.value};f.value[e]=i,console.log(f.value),s(),A()},s=async()=>{const{pathId:e,group:a,version:i}=r.params;await _e({serviceName:e,group:a||"",version:i||"",routes:f.value})},j=e=>{f.value.splice(e,1)},A=async()=>{const{pathId:e,group:a,version:i}=r.params,d=await fe({serviceName:e,group:a,version:i});d.code===200&&o.list.forEach(c=>{var P;c.key==="paramRoute"&&(c.form.paramRoute=(P=d.data)==null?void 0:P.routes)})},U=async()=>{const{pathId:e,group:a,version:i}=r.params,d=await ue({serviceName:e,group:a||"",version:i||""});o.list.forEach(c=>{c.key==="timeout"&&(c.form.timeout=d.data.timeout)})},E=async e=>{const{pathId:a,group:i,version:l}=r.params;await de({serviceName:a,group:i||"",version:l||"",timeout:e}),await U()},O=async()=>{const{pathId:e,group:a,version:i}=r.params,d=await ce({serviceName:e,group:a||"",version:i||""});o.list.forEach(c=>{c.key==="retryNum"&&(c.form.retryNum=d.data.retryTimes)})},M=async e=>{const{pathId:a,group:i,version:l}=r.params;await me({serviceName:a,group:i||"",version:l||"",retryTimes:e}),await O()},F=async()=>{const{pathId:e,group:a,version:i}=r.params,d=await ve({serviceName:e,group:a||"",version:i||""});o.list.forEach(c=>{var P;c.key==="sameAreaFirst"&&(c.form.sameAreaFirst=(P=d.data)==null?void 0:P.enabled)})},B=async e=>{const{pathId:a,group:i,version:l}=r.params;await pe({serviceName:a,group:i||"",version:l||"",enabled:e}),await F()};return re(async()=>{await U(),await O(),await F(),await A()}),(e,a)=>{const i=m("a-input-number"),l=m("a-form-item"),d=m("a-radio-button"),c=m("a-radio-group"),P=m("a-button");return u(),D("div",ke,[n(le,{options:o},{form_timeout:t(({current:v})=>[n(l,{label:e.$t("serviceDomain.timeout"),name:"timeout"},{default:t(()=>[n(i,{value:v.form.timeout,"onUpdate:value":p=>v.form.timeout=p,"addon-after":"ms",style:{width:"150px"}},null,8,["value","onUpdate:value"])]),_:2},1032,["label"])]),form_retryNum:t(({current:v})=>[n(l,{label:e.$t("serviceDomain.retryNum"),name:"retryNum"},{default:t(()=>[n(i,{value:v.form.retryNum,"onUpdate:value":p=>v.form.retryNum=p,"addon-after":"次",style:{width:"150px"}},null,8,["value","onUpdate:value"])]),_:2},1032,["label"])]),form_sameAreaFirst:t(({current:v})=>[n(l,{label:e.$t("serviceDomain.sameAreaFirst"),name:"sameAreaFirst"},{default:t(()=>[n(c,{value:v.form.sameAreaFirst,"onUpdate:value":p=>v.form.sameAreaFirst=p,"button-style":"solid"},{default:t(()=>[n(d,{value:!1},{default:t(()=>[R($(e.$t("serviceDomain.closed")),1)]),_:1}),n(d,{value:!0},{default:t(()=>[R($(e.$t("serviceDomain.opened")),1)]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["label"])]),form_paramRoute:t(({current:v})=>[n(l,{name:"paramRoute"},{default:t(()=>[X("div",we,[(u(!0),D(z,null,J(v.form.paramRoute,(p,S)=>(u(),_(Ie,{class:"param-route",key:S,paramRouteForm:p,index:S,onUpdate:k,onDeleteParamRoute:j},null,8,["paramRouteForm","index"]))),128)),n(P,{type:"primary",style:{"margin-top":"20px"},onClick:I},{default:t(()=>[R("增加路由")]),_:1})])]),_:2},1024)]),_:1},8,["options"])])}}}),Ue=Y(Re,[["__scopeId","data-v-957e6409"]]);export{Ue as default};

import{u as $e}from"./index-fgUiU05I.js";import{d as Te,g as Ue,u as we,n as W,r as De,Q as Re,f as x,c as e,t as a,e as q,o as y,z as $,v as _,h as A,a9 as Ke,aa as Oe,K as j,F,y as Q,J as B,B as V,I as E,G as qe,H as je,_ as Se}from"./index-DjBintlM.js";import{g as Ae,u as Ee}from"./traffic-jO2-nS2i.js";import"./request-Q-EYbbyM.js";const N=L=>(qe("data-v-38e2f072"),L=L(),je(),L),ze={class:"__container_routingRule_detail"},Ve={style:{"max-width":"400px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},Be=N(()=>B("br",null,null,-1)),Ge=N(()=>B("br",null,null,-1)),Pe=N(()=>B("br",null,null,-1)),We=N(()=>B("br",null,null,-1)),me=N(()=>B("br",null,null,-1)),xe=N(()=>B("br",null,null,-1)),Ne=Te({__name:"updateByFormView",setup(L){Ue();const H=we(),m=W(!1),X=W(8);$e().toClipboard;const k=De({version:"",ruleGranularity:"",objectOfAction:"",enable:!0,faultTolerantProtection:!1,runtime:!0,priority:null,group:""}),I=W([{label:"host",value:"host"},{label:"application",value:"application"},{label:"method",value:"method"},{label:"arguments",value:"arguments"},{label:"attachments",value:"attachments"},{label:"其他",value:"other"}]),ee=W([{label:"host",value:"host"},{label:"其他",value:"other"}]),G=W([{label:"=",value:"="},{label:"!=",value:"!="}]),te=W([{label:"应用",value:"application"},{label:"服务",value:"service"}]),d=W([{selectedMatchConditionTypes:[],requestMatch:[],selectedRouteDistributeMatchTypes:[],routeDistribute:[{type:"host",condition:"=",value:"127.0.0.1"},{type:"other",list:[{myKey:"key",condition:"=",value:"value"}]}]}]),le=()=>{d.value.push({selectedMatchConditionTypes:[],requestMatch:[],selectedRouteDistributeMatchTypes:[],routeDistribute:[{type:"host",condition:"=",value:"127.0.0.1"},{type:"other",list:[{myKey:"key",condition:"=",value:"value"}]}]})},ae=s=>{d.value.splice(s,1)},ne=s=>{d.value[s].requestMatch=[],d.value[s].selectedMatchConditionTypes=[]},se=s=>{d.value[s].requestMatch=[{type:"host",condition:"",value:""},{type:"application",condition:"",value:""},{type:"method",condition:"",value:""},{type:"arguments",list:[{index:0,condition:"",value:""}]},{type:"attachments",list:[{myKey:"key",condition:"",value:""}]},{type:"other",list:[{myKey:"key",condition:"",value:""}]}]},J=(s,t)=>{d.value[t].selectedMatchConditionTypes=d.value[t].selectedMatchConditionTypes.filter(i=>i!==s)},oe=(s,t)=>{d.value[t].selectedRouteDistributeMatchTypes=d.value[t].selectedRouteDistributeMatchTypes.filter(i=>i!==s)},ie=[{dataIndex:"index",key:"index",title:"参数索引"},{dataIndex:"condition",key:"condition",title:"关系"},{dataIndex:"value",key:"value",title:"值"},{dataIndex:"operation",key:"operation",title:"操作"}],ue=(s,t)=>{d.value[s].requestMatch[t].list.push({index:0,condition:"=",value:""})},ce=(s,t,i)=>{d.value[s].requestMatch[t].list.length===1&&(d.value[s].selectedMatchConditionTypes=d.value[s].selectedMatchConditionTypes.filter(h=>h!=="arguments")),d.value[s].requestMatch[t].list.splice(i,1)},de=[{dataIndex:"myKey",key:"myKey",title:"键"},{dataIndex:"condition",key:"condition",title:"关系"},{dataIndex:"value",key:"value",title:"值"},{dataIndex:"operation",key:"operation",title:"操作"}],re=(s,t)=>{d.value[s].requestMatch[t].list.push({key:"key",condition:"=",value:""})},pe=(s,t,i)=>{d.value[s].requestMatch[t].list.length===1&&(d.value[s].selectedMatchConditionTypes=d.value[s].selectedMatchConditionTypes.filter(h=>h!=="attachments")),d.value[s].requestMatch[t].list.splice(i,1)},Y=[{dataIndex:"myKey",key:"myKey",title:"键"},{dataIndex:"condition",key:"condition",title:"关系"},{dataIndex:"value",key:"value",title:"值"},{dataIndex:"operation",key:"operation",title:"操作"}],ve=(s,t)=>{d.value[s].requestMatch[t].list.push({myKey:"",condition:"=",value:""})},ye=(s,t,i)=>{if(d.value[s].requestMatch[t].list.length===1){d.value[s].selectedMatchConditionTypes=d.value[s].selectedMatchConditionTypes.filter(h=>h!=="other");return}d.value[s].requestMatch[t].list.splice(i,1)},he=(s,t)=>{d.value[s].routeDistribute[t].list.push({myKey:"",condition:"=",value:""})},fe=(s,t,i)=>{if(d.value[s].routeDistribute[t].list.length===1){d.value[s].selectedRouteDistributeMatchTypes=d.value[s].selectedRouteDistributeMatchTypes.filter(h=>h!=="other");return}d.value[s].routeDistribute[t].list.splice(i,1)},_e=s=>{var v,R;const t=d.value[s],{ruleGranularity:i,objectOfAction:h}=k;let c=`对于${i==="service"?"服务":"应用"}【${h||"未指定"}】`,n=[];(v=t.selectedMatchConditionTypes)==null||v.forEach(D=>{var P,r,C,l;const p=(P=t.requestMatch)==null?void 0:P.find(w=>w.type===D);if(!p)return;let U="";const S=p.condition==="="?"等于":p.condition==="!="?"不等于":p.condition||"",z=p.value||"未指定";switch(D){case"host":U=`请求来源主机 ${S} ${z}`;break;case"application":U=`请求来源应用 ${S} ${z}`;break;case"method":U=`请求方法 ${S} ${z}`;break;case"arguments":const w=(r=p.list)==null?void 0:r.map(M=>{const O=M.condition==="="?"等于":M.condition==="!="?"不等于":M.condition||"",T=M.value!==void 0&&M.value!==""?M.value:"未指定";return`参数[${M.index}] ${O} ${T}`}).filter(Boolean);(w==null?void 0:w.length)>0&&(U=w.join(" 且 "));break;case"attachments":const u=(C=p.list)==null?void 0:C.map(M=>{const O=M.condition==="="?"等于":M.condition==="!="?"不等于":M.condition||"",T=M.value!==void 0&&M.value!==""?M.value:"未指定";return`附件[${M.myKey||"未指定"}] ${O} ${T}`}).filter(Boolean);(u==null?void 0:u.length)>0&&(U=u.join(" 且 "));break;case"other":const f=(l=p.list)==null?void 0:l.map(M=>{const O=M.condition==="="?"等于":M.condition==="!="?"不等于":M.condition||"",T=M.value!==void 0&&M.value!==""?M.value:"未指定";return`自定义匹配[${M.myKey||"未指定"}] ${O} ${T}`}).filter(Boolean);(f==null?void 0:f.length)>0&&(U=f.join(" 且 "));break}U&&((D==="host"||D==="application"||D==="method")&&!p.value?n.push(`${D==="host"?"请求来源主机":D==="application"?"请求来源应用":"请求方法"} 未填写`):n.push(U))});const b=n.length>0?n.join(" 且 "):"任意请求";let o=[];(R=t.selectedRouteDistributeMatchTypes)==null||R.forEach(D=>{var P,r;const p=(P=t.routeDistribute)==null?void 0:P.find(C=>C.type===D);if(!p)return;let U="";const S=p.condition==="="?"等于":p.condition==="!="?"不等于":p.condition||"",z=p.value||"未指定";switch(D){case"host":U=`目标主机 ${S} ${z}`;break;case"other":const C=(r=p.list)==null?void 0:r.map(l=>{const w=l.condition==="="?"等于":l.condition==="!="?"不等于":l.condition||"",u=l.value!==void 0&&l.value!==""?l.value:"未指定";return`目标标签[${l.myKey||"未指定"}] ${w} ${u}`}).filter(Boolean);(C==null?void 0:C.length)>0&&(U=C.join(" 且 "));break}U&&(D==="host"&&!p.value?o.push("目标主机 未填写"):o.push(U))});const g=o.length>0?`满足 【${o.join(" 且 ")}】`:"默认路由规则";return`${c}，将满足 【${b}】 条件的请求，转发到 ${g} 的实例。`};function ke(s,t){const i=[],h=s.split(" & ");return[{type:"host",condition:"",value:""},{type:"application",condition:"",value:""},{type:"method",condition:"",value:""},{type:"arguments",list:[]},{type:"attachments",list:[]},{type:"other",list:[]}].forEach(c=>i.push({...c})),h.forEach(c=>{if(c=c.trim(),c.startsWith("host")){d.value[t].selectedMatchConditionTypes.push("host");const n=c.match(/^host(!=|=)(.+)/);if(n){const b=n[1],o=n[2].trim(),g=i.find(v=>v.type==="host");g.condition=b,g.value=o}}else if(c.startsWith("application")){d.value[t].selectedMatchConditionTypes.push("application");const n=c.match(/^application(!=|=)(.+)/);if(n){const b=n[1],o=n[2].trim(),g=i.find(v=>v.type==="application");g.condition=b,g.value=o}}else if(c.startsWith("method")){d.value[t].selectedMatchConditionTypes.push("method");const n=c.match(/^method(!=|=)(.+)/);if(n){const b=n[1],o=n[2].trim(),g=i.find(v=>v.type==="method");g.condition=b,g.value=o}}else if(c.startsWith("arguments")){!d.value[t].selectedMatchConditionTypes.includes("arguments")&&d.value[t].selectedMatchConditionTypes.push("arguments");const n=c.match(/^arguments\[(\d+)\](!=|=)(.+)/);if(n){const b=parseInt(n[1],10),o=n[2],g=n[3].trim();i.find(R=>R.type==="arguments").list.push({index:b,condition:o,value:g})}}else if(c.startsWith("attachments")){!d.value[t].selectedMatchConditionTypes.includes("attachments")&&d.value[t].selectedMatchConditionTypes.push("attachments");const n=c.match(/^attachments\[(.+)\](!=|=)(.+)/);if(n){const b=n[1].trim(),o=n[2],g=n[3].trim();i.find(R=>R.type==="attachments").list.push({myKey:b,condition:o,value:g})}}else if(c.startsWith("other")){!d.value[t].selectedMatchConditionTypes.includes("other")&&d.value[t].selectedMatchConditionTypes.push("other");const n=c.match(/^other\[(.+)\](!=|=)(.+)/);if(n){const b=n[1].trim(),o=n[2],g=n[3].trim();i.find(R=>R.type==="other").list.push({myKey:b,condition:o,value:g})}}}),i}function be(s,t){const i=[],h=s==null?void 0:s.split(" & ");return[{type:"host",condition:"",value:""},{type:"other",list:[]}].forEach(c=>i.push({...c})),h!=null&&h.length&&h.forEach(c=>{if(c=c.trim(),c.startsWith("host")){d.value[t].selectedRouteDistributeMatchTypes.push("host");const n=c.match(/^host(!=|=)(.+)/);if(n){const b=n[1],o=n[2].trim(),g=i.find(v=>v.type==="host");g.condition=b,g.value=o}}else if(c.startsWith("other")){!d.value[t].selectedRouteDistributeMatchTypes.includes("other")&&d.value[t].selectedRouteDistributeMatchTypes.push("other");const n=c.match(/^other\[(.+)\](!=|=)(.+)/);if(n){const b=n[1].trim(),o=n[2],g=n[3].trim();i.find(R=>R.type==="other").list.push({myKey:b,condition:o,value:g})}}}),i}async function Z(){var t;let s=await Ae((t=H.params)==null?void 0:t.ruleName);if((s==null?void 0:s.code)===200){console.log("res",s.data);const{conditions:i,configVersion:h,enabled:K,force:c,key:n,runtime:b,scope:o}=s==null?void 0:s.data;k.ruleGranularity=o,k.objectOfAction=n,k.enable=K,k.faultTolerantProtection=c,k.runtime=b,k.configVersion=h,h=="v3.0"&&i.forEach((g,v)=>{var U,S;const R=g.split("=>"),D=(U=R[0])==null?void 0:U.trim(),p=(S=R[1])==null?void 0:S.trim();d.value[v].requestMatch=ke(D,v),d.value[v].routeDistribute=be(p,v)})}}function ge(){let s=[],t="",i="";return d.value.forEach((h,K)=>{h.selectedMatchConditionTypes.forEach((n,b)=>{h.requestMatch.forEach((o,g)=>{if(n==(o==null?void 0:o.type))switch(o==null?void 0:o.type){case"arguments":o.list.forEach((v,R)=>{t.length>0&&(t+=" & "),t+=`${n}[${v.index}]${v.condition}${v.value}`});break;case"attachments":o.list.forEach((v,R)=>{t.length>0&&(t+=" & "),t+=`${n}[${v.myKey}]${v.condition}${v.value}`});break;case"other":o.list.forEach((v,R)=>{t.length>0&&(t+=" & "),t+=`${n}[${v.myKey}]${v.condition}${v.value}`});break;default:t.length>0&&(t+=" & "),t+=`${o.type}${o.condition}${o.value}`}})}),h.selectedRouteDistributeMatchTypes.forEach((n,b)=>{h.routeDistribute.forEach((o,g)=>{if(n==(o==null?void 0:o.type))switch(o==null?void 0:o.type){case"other":o==null||o.list.forEach((v,R)=>{i.length>0&&(i+=" & "),i+=`${n}[${v.myKey}]${v.condition}${v.value}`});break;default:i.length>0&&(i+=" & "),i+=`${o.type}${o.condition}${o.value}`}})});let c="";t.length>0&&i.length>0?c=`${t} => ${i}`:t.length>0&&i.length==0&&(c=`${t}`),s.push(c)}),s}const Ce=async()=>{const{ruleName:s}=H.params,{version:t,ruleGranularity:i,objectOfAction:h,enable:K,faultTolerantProtection:c,runtime:n}=k,b={configVersion:"v3.0",scope:i,key:h,enabled:K,force:c,runtime:n,conditions:ge()},o=await Ee(s,b);(o==null?void 0:o.code)===200&&await Z()},Me=()=>{var t;const s=(t=H.params)==null?void 0:t.ruleName;if(s&&k.ruleGranularity==="service"){const i=s==null?void 0:s.split(":");k.version=i[1],k.group=i[2].split(".")[0]}};return Re(async()=>{await Z(),Me()}),(s,t)=>{const i=q("a-button"),h=q("a-flex"),K=q("a-select"),c=q("a-form-item"),n=q("a-input"),b=q("a-switch"),o=q("a-col"),g=q("a-input-number"),v=q("a-row"),R=q("a-form"),D=q("a-card"),p=q("a-space"),U=q("a-tag"),S=q("a-table"),z=q("a-descriptions-item"),P=q("a-descriptions");return y(),x("div",ze,[e(h,{style:{width:"100%"}},{default:a(()=>[e(o,{span:m.value?24-X.value:24,class:"left"},{default:a(()=>[e(D,null,{default:a(()=>[e(p,{style:{width:"100%"},direction:"vertical",size:"middle"},{default:a(()=>[e(v,null,{default:a(()=>[e(h,{justify:"end",style:{width:"100%"}},{default:a(()=>[e(i,{type:"text",style:{color:"#0a90d5"},onClick:t[0]||(t[0]=r=>m.value=!m.value)},{default:a(()=>[$(" 字段说明 "),m.value?(y(),_(A(Oe),{key:1})):(y(),_(A(Ke),{key:0}))]),_:1})]),_:1}),e(D,{title:"基础信息",style:{width:"100%"},class:"_detail"},{default:a(()=>[e(R,{layout:"horizontal"},{default:a(()=>[e(v,{style:{width:"100%"}},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(c,{label:"规则粒度",required:""},{default:a(()=>[e(K,{disabled:"",value:k.ruleGranularity,"onUpdate:value":t[1]||(t[1]=r=>k.ruleGranularity=r),style:{width:"120px"},options:te.value},null,8,["value","options"])]),_:1}),k.ruleGranularity==="service"?(y(),_(c,{key:0,label:"版本",required:""},{default:a(()=>[e(n,{value:k.version,"onUpdate:value":t[2]||(t[2]=r=>k.version=r),style:{width:"300px"},disabled:""},null,8,["value"])]),_:1})):j("",!0),e(c,{label:"容错保护"},{default:a(()=>[e(b,{checked:k.faultTolerantProtection,"onUpdate:checked":t[3]||(t[3]=r=>k.faultTolerantProtection=r),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(c,{label:"运行时生效"},{default:a(()=>[e(b,{checked:k.runtime,"onUpdate:checked":t[4]||(t[4]=r=>k.runtime=r),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(c,{label:"作用对象",required:""},{default:a(()=>[e(n,{disabled:"",value:k.objectOfAction,"onUpdate:value":t[5]||(t[5]=r=>k.objectOfAction=r),style:{width:"300px"}},null,8,["value"])]),_:1}),k.ruleGranularity==="service"?(y(),_(c,{key:0,label:"分组",required:""},{default:a(()=>[e(n,{value:k.group,"onUpdate:value":t[6]||(t[6]=r=>k.group=r),style:{width:"300px"},disabled:""},null,8,["value"])]),_:1})):j("",!0),e(c,{label:"立即启用"},{default:a(()=>[e(b,{checked:k.enable,"onUpdate:checked":t[7]||(t[7]=r=>k.enable=r),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1}),e(c,{label:"优先级"},{default:a(()=>[e(g,{value:k.priority,"onUpdate:value":t[8]||(t[8]=r=>k.priority=r),min:"1"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{title:"路由列表",style:{width:"100%"},class:"_detail"},{default:a(()=>[(y(!0),x(F,null,Q(d.value,(r,C)=>(y(),_(D,null,{title:a(()=>[e(h,{justify:"space-between"},{default:a(()=>[e(p,{align:"center"},{default:a(()=>[B("div",null,"路由【"+V(C+1)+"】",1),B("div",Ve,V(_e(C)),1)]),_:2},1024),e(A(E),{onClick:l=>ae(C),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)]),default:a(()=>[e(R,{layout:"horizontal"},{default:a(()=>[e(p,{style:{width:"100%"},direction:"vertical",size:"large"},{default:a(()=>[e(c,{label:"请求匹配"},{default:a(()=>[r.requestMatch.length>0?(y(),_(D,{key:0},{default:a(()=>[e(p,{style:{width:"100%"},direction:"vertical",size:"small"},{default:a(()=>[e(h,{align:"center",justify:"space-between"},{default:a(()=>[e(c,{label:"匹配条件类型"},{default:a(()=>[e(K,{value:r.selectedMatchConditionTypes,"onUpdate:value":l=>r.selectedMatchConditionTypes=l,options:I.value,mode:"multiple",style:{"min-width":"200px"}},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(A(E),{onClick:l=>ne(C),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024),(y(!0),x(F,null,Q(r.requestMatch,(l,w)=>(y(),x(F,null,[r.selectedMatchConditionTypes.includes("host")&&l.type==="host"?(y(),_(p,{key:0,size:"large",align:"center"},{default:a(()=>[e(U,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:a(()=>[$(V(l==null?void 0:l.type),1)]),_:2},1024),e(K,{value:l.condition,"onUpdate:value":u=>l.condition=u,style:{"min-width":"120px"},options:G.value},null,8,["value","onUpdate:value","options"]),e(n,{value:l.value,"onUpdate:value":u=>l.value=u,placeholder:"请求来源ip"},null,8,["value","onUpdate:value"]),e(A(E),{onClick:u=>J(l==null?void 0:l.type,C),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)):j("",!0),r.selectedMatchConditionTypes.includes("application")&&l.type==="application"?(y(),_(p,{key:1,size:"large",align:"center"},{default:a(()=>[e(U,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:a(()=>[$(V(l==null?void 0:l.type),1)]),_:2},1024),e(K,{value:l.condition,"onUpdate:value":u=>l.condition=u,style:{"min-width":"120px"},options:G.value},null,8,["value","onUpdate:value","options"]),e(n,{value:l.value,"onUpdate:value":u=>l.value=u,placeholder:"请求来源应用名"},null,8,["value","onUpdate:value"]),e(A(E),{onClick:u=>J(l==null?void 0:l.type,C),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)):j("",!0),r.selectedMatchConditionTypes.includes("method")&&l.type==="method"?(y(),_(p,{key:2,size:"large",align:"center"},{default:a(()=>[e(U,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:a(()=>[$(V(l==null?void 0:l.type),1)]),_:2},1024),e(K,{value:l.condition,"onUpdate:value":u=>l.condition=u,style:{"min-width":"120px"},options:G.value},null,8,["value","onUpdate:value","options"]),e(n,{value:l.value,"onUpdate:value":u=>l.value=u,placeholder:"方法值"},null,8,["value","onUpdate:value"]),e(A(E),{onClick:u=>J(l==null?void 0:l.type,C),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)):j("",!0),r.selectedMatchConditionTypes.includes("arguments")&&l.type==="arguments"?(y(),_(p,{key:3,style:{width:"100%"},size:"large",align:"start"},{default:a(()=>[e(U,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:a(()=>[$(V(l==null?void 0:l.type),1)]),_:2},1024),e(p,{direction:"vertical"},{default:a(()=>[e(i,{type:"primary",onClick:u=>ue(C,w)},{default:a(()=>[$(" 添加argument ")]),_:2},1032,["onClick"]),e(S,{pagination:!1,columns:ie,"data-source":r.requestMatch[w].list},{bodyCell:a(({column:u,record:f,text:M,index:O})=>[u.key==="index"?(y(),_(n,{key:0,value:f.index,"onUpdate:value":T=>f.index=T,placeholder:"index"},null,8,["value","onUpdate:value"])):u.key==="condition"?(y(),_(K,{key:1,value:f.condition,"onUpdate:value":T=>f.condition=T,options:G.value},null,8,["value","onUpdate:value","options"])):u.key==="value"?(y(),_(n,{key:2,value:f.value,"onUpdate:value":T=>f.value=T,placeholder:"value"},null,8,["value","onUpdate:value"])):u.key==="operation"?(y(),_(p,{key:3,align:"center"},{default:a(()=>[e(A(E),{onClick:T=>ce(C,w,O),icon:"tdesign:remove",class:"action-icon"},null,8,["onClick"])]),_:2},1024)):j("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024)):j("",!0),r.selectedMatchConditionTypes.includes("attachments")&&l.type==="attachments"?(y(),_(p,{key:4,style:{width:"100%"},size:"large",align:"start"},{default:a(()=>[e(U,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:a(()=>[$(V(l==null?void 0:l.type),1)]),_:2},1024),e(p,{direction:"vertical"},{default:a(()=>[e(i,{type:"primary",onClick:u=>re(C,w)},{default:a(()=>[$(" 添加attachment ")]),_:2},1032,["onClick"]),e(S,{pagination:!1,columns:de,"data-source":r.requestMatch[w].list},{bodyCell:a(({column:u,record:f,text:M,index:O})=>[u.key==="myKey"?(y(),_(n,{key:0,value:f.myKey,"onUpdate:value":T=>f.myKey=T,placeholder:"key"},null,8,["value","onUpdate:value"])):u.key==="condition"?(y(),_(K,{key:1,value:f.condition,"onUpdate:value":T=>f.condition=T,options:G.value},null,8,["value","onUpdate:value","options"])):u.key==="value"?(y(),_(n,{key:2,value:f.value,"onUpdate:value":T=>f.value=T,placeholder:"value"},null,8,["value","onUpdate:value"])):u.key==="operation"?(y(),_(p,{key:3,align:"center"},{default:a(()=>[e(A(E),{onClick:T=>pe(C,w,O),icon:"tdesign:remove",class:"action-icon"},null,8,["onClick"])]),_:2},1024)):j("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024)):j("",!0),r.selectedMatchConditionTypes.includes("other")&&l.type==="other"?(y(),_(p,{key:5,style:{width:"100%"},size:"large",align:"start"},{default:a(()=>[e(U,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:a(()=>[$(V((l==null?void 0:l.type)=="other"?"其他":l==null?void 0:l.type),1)]),_:2},1024),e(p,{direction:"vertical"},{default:a(()=>[e(i,{type:"primary",onClick:u=>ve(C,w)},{default:a(()=>[$(" 添加other ")]),_:2},1032,["onClick"]),e(S,{pagination:!1,columns:Y,"data-source":r.requestMatch[w].list},{bodyCell:a(({column:u,record:f,text:M})=>[u.key==="myKey"?(y(),_(n,{key:0,value:f.myKey,"onUpdate:value":O=>f.myKey=O,placeholder:"key"},null,8,["value","onUpdate:value"])):u.key==="condition"?(y(),_(K,{key:1,value:f.condition,"onUpdate:value":O=>f.condition=O,options:G.value},null,8,["value","onUpdate:value","options"])):u.key==="value"?(y(),_(n,{key:2,value:f.value,"onUpdate:value":O=>f.value=O,placeholder:"value"},null,8,["value","onUpdate:value"])):u.key==="operation"?(y(),_(p,{key:3,align:"center"},{default:a(()=>[e(A(E),{onClick:O=>ye(C,w,f.index),icon:"tdesign:remove",class:"action-icon"},null,8,["onClick"])]),_:2},1024)):j("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024)):j("",!0)],64))),256))]),_:2},1024)]),_:2},1024)):(y(),_(i,{key:1,onClick:l=>se(C),type:"dashed",size:"large"},{icon:a(()=>[e(A(E),{icon:"tdesign:add"})]),default:a(()=>[$(" 增加匹配条件 ")]),_:2},1032,["onClick"]))]),_:2},1024),e(c,{label:"路由分发",required:""},{default:a(()=>[e(D,null,{default:a(()=>[e(p,{style:{width:"100%"},direction:"vertical",size:"small"},{default:a(()=>[e(h,null,{default:a(()=>[e(c,{label:"匹配条件类型"},{default:a(()=>[e(K,{value:r.selectedRouteDistributeMatchTypes,"onUpdate:value":l=>r.selectedRouteDistributeMatchTypes=l,options:ee.value,mode:"multiple",style:{"min-width":"200px"}},null,8,["value","onUpdate:value","options"])]),_:2},1024)]),_:2},1024),(y(!0),x(F,null,Q(r.routeDistribute,(l,w)=>(y(),x(F,{key:w},[r.selectedRouteDistributeMatchTypes.includes("host")&&l.type==="host"?(y(),_(p,{key:0,size:"large",align:"center"},{default:a(()=>[e(U,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:a(()=>[$(V(l==null?void 0:l.type),1)]),_:2},1024),e(K,{value:l.condition,"onUpdate:value":u=>l.condition=u,style:{"min-width":"120px"},options:G.value},null,8,["value","onUpdate:value","options"]),e(n,{value:l.value,"onUpdate:value":u=>l.value=u,placeholder:"请求来源ip"},null,8,["value","onUpdate:value"]),e(A(E),{onClick:u=>oe(l==null?void 0:l.type,C),class:"action-icon",icon:"tdesign:delete"},null,8,["onClick"])]),_:2},1024)):j("",!0),r.selectedRouteDistributeMatchTypes.includes("other")&&l.type==="other"?(y(),_(p,{key:1,style:{width:"100%"},size:"large",align:"start"},{default:a(()=>[e(U,{class:"match-condition-type-label",bordered:!1,color:"processing"},{default:a(()=>[$(V((l==null?void 0:l.type)=="other"?"其他":l==null?void 0:l.type),1)]),_:2},1024),e(p,{direction:"vertical"},{default:a(()=>[e(i,{type:"primary",onClick:u=>he(C,w)},{default:a(()=>[$(" 添加其他 ")]),_:2},1032,["onClick"]),e(S,{pagination:!1,columns:Y,"data-source":r.routeDistribute[w].list},{bodyCell:a(({column:u,record:f,text:M,index:O})=>[u.key==="myKey"?(y(),_(n,{key:0,value:f.myKey,"onUpdate:value":T=>f.myKey=T,placeholder:"key"},null,8,["value","onUpdate:value"])):u.key==="condition"?(y(),_(K,{key:1,value:f.condition,"onUpdate:value":T=>f.condition=T,options:G.value},null,8,["value","onUpdate:value","options"])):u.key==="value"?(y(),_(n,{key:2,value:f.value,"onUpdate:value":T=>f.value=T,placeholder:"value"},null,8,["value","onUpdate:value"])):u.key==="operation"?(y(),_(p,{key:3,align:"center"},{default:a(()=>[e(A(E),{onClick:T=>fe(C,w,O),icon:"tdesign:remove",class:"action-icon"},null,8,["onClick"])]),_:2},1024)):j("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024)):j("",!0)],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1}),e(i,{onClick:le,type:"primary"},{default:a(()=>[$(" 增加路由")]),_:1})]),_:1})]),_:1})]),_:1},8,["span"]),e(o,{span:m.value?X.value:0,class:"right"},{default:a(()=>[m.value?(y(),_(D,{key:0,class:"sliderBox"},{default:a(()=>[B("div",null,[e(P,{title:"字段说明",column:1},{default:a(()=>[e(z,{label:"key"},{default:a(()=>[$(" 作用对象"),Be,$(" 可能的值：Dubbo应用名或者服务名 ")]),_:1}),e(z,{label:"scope"},{default:a(()=>[$(" 规则粒度"),Ge,$(" 可能的值：application, service ")]),_:1}),e(z,{label:"force"},{default:a(()=>[$(" 容错保护"),Pe,$(" 可能的值：true, false"),We,$(" 描述：如果为true，则路由筛选后若没有可用的地址则会直接报异常；如果为false，则会从可用地址中选择完成RPC调用 ")]),_:1}),e(z,{label:"runtime"},{default:a(()=>[$(" 运行时生效"),me,$(" 可能的值：true, false"),xe,$(" 描述：如果为true，则该rule下的所有路由将会实时生效；若为false，则只有在启动时才会生效 ")]),_:1})]),_:1})])]),_:1})):j("",!0)]),_:1},8,["span"])]),_:1}),e(D,{class:"footer"},{default:a(()=>[e(h,null,{default:a(()=>[e(i,{type:"primary",onClick:Ce},{default:a(()=>[$("确认")]),_:1}),e(i,{style:{"margin-left":"30px"},onClick:t[9]||(t[9]=r=>console.log(d.value))},{default:a(()=>[$(" 取消")]),_:1})]),_:1})]),_:1})])}}}),Qe=Se(Ne,[["__scopeId","data-v-38e2f072"]]);export{Qe as default};
